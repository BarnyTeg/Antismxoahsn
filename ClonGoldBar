-- Получаем сервисы
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

-- Получаем локального игрока
local player = Players.LocalPlayer

-- Функция для уведомлений
local function notify(title, message)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = message,
        Duration = 5
    })
end

-- Функция для удаления сварок (Welds), чтобы избежать залипания
local function removeWelds(tool)
    if tool:FindFirstChild("Handle") then
        for _, weld in pairs(tool.Handle:GetDescendants()) do
            if weld:IsA("Weld") or weld:IsA("WeldConstraint") then
                weld:Destroy()
            end
        end
    end
end

-- Функция для дюпа бандажа
local function dupeBandage()
    -- Проверяем, есть ли персонаж
    if not player.Character then
        notify("Error", "You need a character to use this script!")
        return
    end

    -- Проверяем, есть ли инвентарь (Backpack)
    local backpack = player:FindFirstChildOfClass("Backpack")
    if not backpack then
        notify("Error", "No backpack found!")
        return
    end

    -- Ищем бандаж в инвентаре
    local bandage = nil
    for _, tool in pairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and tool.Name:lower() == "bandage" then
            bandage = tool
            break
        end
    end

    if not bandage then
        -- Проверяем, не экипирован ли бандаж
        for _, tool in pairs(player.Character:GetChildren()) do
            if tool:IsA("Tool") and tool.Name:lower() == "bandage" then
                bandage = tool
                break
            end
        end
    end

    if not bandage then
        notify("Error", "No bandage found in your inventory or equipped!")
        return
    end

    -- Убираем бандаж из руки, если он экипирован
    if bandage.Parent == player.Character then
        bandage.Parent = backpack -- Возвращаем в инвентарь
        wait(0.1) -- Даем время на обработку
    end

    -- Клонируем бандаж
    local clonedBandage = bandage:Clone()
    if not clonedBandage then
        notify("Error", "Failed to clone the bandage!")
        return
    end

    -- Удаляем сварки, чтобы избежать залипания
    removeWelds(clonedBandage)

    -- Помещаем клонированный бандаж в мир
    clonedBandage.Parent = Workspace
    local root = player.Character:FindFirstChild("HumanoidRootPart")
    if root and clonedBandage:FindFirstChild("Handle") then
        -- Позиционируем бандаж рядом с игроком
        clonedBandage.Handle.CFrame = root.CFrame + Vector3.new(2, 2, 2)
        clonedBandage.Handle.Anchored = true -- Фиксируем, чтобы не упал
    else
        notify("Error", "Failed to position the cloned bandage!")
        return
    end

    -- Уведомляем
    notify("Dupe Bandage", "Bandage cloned and dropped! Attempting to refresh...")

    -- Пробуем обновить персонажа без убийства
    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        -- Сохраняем текущую позицию
        local originalCFrame = player.Character.HumanoidRootPart.CFrame
        -- Перемещаем персонажа на мгновение в "никуда", чтобы сбросить состояние
        player.Character.HumanoidRootPart.CFrame = CFrame.new(Vector3.new(0, 10000, 0))
        wait(0.1)
        -- Возвращаем персонажа обратно
        player.Character.HumanoidRootPart.CFrame = originalCFrame
    end

    -- Разанкориваем бандаж, чтобы его можно было подобрать
    if clonedBandage and clonedBandage:FindFirstChild("Handle") then
        clonedBandage.Handle.Anchored = false
    end

    -- Уведомляем о следующем шаге
    wait(1)
    notify("Dupe Bandage", "Refresh complete! Try picking up the cloned bandage.")
end

-- Запускаем дюп
dupeBandage()
