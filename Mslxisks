local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
while not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") do
    wait(0.1)
end

-- Создаем сиденье с правильным позиционированием
local seat = Instance.new("Seat")
seat.Name = "HelicopterSeat"
seat.Size = Vector3.new(4, 0.4, 4) -- Тонкое сиденье (меньше вероятность коллизий)
seat.Anchored = true
seat.CanCollide = true

-- Позиция сиденья (3 метра перед игроком + 1.5 метра вверх)
seat.CFrame = player.Character.HumanoidRootPart.CFrame 
             * CFrame.new(0, 1.5, -3) 
             * CFrame.Angles(-0.3, math.rad(180), 0) -- Наклон спинки назад
seat.Parent = Workspace

-- Точная поза для сидения (на поверхности сиденья)
local targetCFrame = seat.CFrame 
                   * CFrame.new(0, seat.Size.Y/2 + 0.5, 0) -- Сидит НА сиденье
                   * CFrame.Angles(-0.3, 0, 0) -- Наклон корпуса

-- Автоматическая посадка
seat.Touched:Connect(function(hit)
    local humanoid = hit.Parent:FindFirstChildOfClass("Humanoid")
    if humanoid and humanoid == player.Character.Humanoid then
        
        -- 1. Включаем режим сидения
        humanoid.Sit = true
        humanoid.PlatformStand = true
        
        -- 2. Телепортация в точную позицию
        humanoid.RootPart.CFrame = targetCFrame
        
        -- 3. Фиксация позиции (3 кадра подряд для надежности)
        for i = 1, 3 do
            task.wait(0.1)
            humanoid.RootPart.CFrame = targetCFrame
        end
    end
end)

-- Выход по прыжку (с небольшим толчком)
player.Character.Humanoid.Jumping:Connect(function()
    if player.Character.Humanoid.Sit then
        player.Character.Humanoid.PlatformStand = false
        player.Character.Humanoid.Sit = false
        player.Character.HumanoidRootPart.Velocity = seat.CFrame.LookVector * 12
    end
end)

-- Визуальный маркер сиденья (для отладки)
local marker = Instance.new("Part")
marker.Size = Vector3.new(1, 0.2, 1)
marker.CFrame = targetCFrame
marker.Anchored = true
marker.CanCollide = false
marker.Transparency = 0.7
marker.Color = Color3.new(1, 0, 0)
marker.Parent = Workspace
