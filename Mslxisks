local player = game:GetService("Players").LocalPlayer
local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
local workspace = game:GetService("Workspace")
local replicated = game:GetService("ReplicatedStorage")

-- Настройки
local radius = 25 -- Радиус
local damage = 1000 -- Урон
local cooldown = 0.05 -- Задержка

-- Шаг 1: Поиск врагов
local function getEnemies()
    local enemies = {}
    if not hrp then
        print("Где твой перс? Жду HumanoidRootPart!")
        return enemies
    end
    for _, v in pairs(workspace:GetDescendants()) do
        if v:FindFirstChild("Humanoid") and v ~= player.Character then
            local enemyHRP = v:FindFirstChild("HumanoidRootPart") or v:FindFirstChild("Torso")
            if enemyHRP and (enemyHRP.Position - hrp.Position).Magnitude <= radius then
                table.insert(enemies, v)
                print("Найден враг: " .. v.Name .. " (" .. v:GetFullName() .. ")")
            end
        end
    end
    print("Всего врагов в радиусе: " .. #enemies)
    return enemies
end

-- Шаг 2: Тест RemoteEvent
local function testRemoteEvents(enemy)
    local remotes = {
        ["Shoot"] = replicated.Remotes.Weapon:FindFirstChild("Shoot"),
        ["ReplicateShot"] = replicated.Remotes.Weapon:FindFirstChild("ReplicateShot"),
        ["RagdollFlop"] = replicated.Shared.Remotes:FindFirstChild("RagdollFlop")
    }
    local workingRemote = nil

    if enemy and enemy:FindFirstChild("Humanoid") then
        for name, remote in pairs(remotes) do
            if remote then
                remote:FireServer(enemy.Humanoid, damage) -- Тест с Humanoid
                print("Тест " .. name .. " на " .. enemy.Name)
                wait(1) -- Ждём реакции
                if enemy.Humanoid.Health <= 0 then
                    workingRemote = remote
                    print(name .. " сработал! Враг " .. enemy.Name .. " мёртв!")
                    break
                end
            end
        end
    end
    return workingRemote
end

-- Шаг 3: Килл аура
local function startKillAura()
    local enemies = getEnemies()
    local testEnemy = enemies[1] -- Берём первого врага для теста
    local remote = nil

    if testEnemy then
        remote = testRemoteEvents(testEnemy)
    else
        print("Врагов не нашёл, стой ближе к зомбакам!")
    end

    if not remote then
        print("Ни один RemoteEvent не сработал, юзаю Shoot по умолчанию")
        remote = replicated.Remotes.Weapon:FindFirstChild("Shoot")
    end

    -- Запуск ауры
    spawn(function()
        while wait(cooldown) do
            if not hrp then
                hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                if not hrp then continue end
            end
            local currentEnemies = getEnemies()
            for _, enemy in pairs(currentEnemies) do
                if enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                    if remote then
                        remote:FireServer(enemy.Humanoid, damage)
                        print("Мочу " .. enemy.Name .. " через " .. remote.Name)
                    else
                        enemy.Humanoid:TakeDamage(damage) -- Fallback
                        print("Remote не нашёл, бью клиентски " .. enemy.Name)
                    end
                end
            end
            if #currentEnemies > 0 then
                print("Валю " .. #currentEnemies .. " врагов!")
            end
        end
    end)
end

-- Старт
print("Запускаю килл ауру 5.0 — всё в одном!")
startKillAura()
