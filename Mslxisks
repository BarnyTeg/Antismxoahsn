local player = game:GetService("Players").LocalPlayer

-- Безопасная версия godMode
local function safeGodMode(character)
    local humanoid = character:WaitForChild("Humanoid", 5) -- Таймаут 5 сек
    
    if not humanoid then return end
    
    humanoid.MaxHealth = math.huge
    humanoid.Health = math.huge
    
    -- Более безопасный обработчик урона
    local healthConnection
    healthConnection = humanoid.HealthChanged:Connect(function()
        if humanoid.Health < humanoid.MaxHealth then
            healthConnection:Disconnect() -- Предотвращаем рекурсию
            humanoid.Health = humanoid.MaxHealth
            healthConnection = humanoid.HealthChanged:Connect(function() end) -- Новый обработчик
        end
    end)
    
    -- Защита от респавна
    character:WaitForChild("HumanoidRootPart", 2).AncestryChanged:Connect(function()
        task.defer(function()
            if not character:IsDescendantOf(workspace) then
                player:LoadCharacter()
            end
        end)
    end)
end

-- Альтернативный антибан без хук-функций
local function safeAntiBan()
    local function fakeReport()
        return nil
    end
    
    if not player:FindFirstChild("ReportPlayer") then
        local fake = Instance.new("BindableFunction")
        fake.Name = "ReportPlayer"
        fake.OnInvoke = fakeReport
        fake.Parent = player
    end
end

-- Запуск с защитой от ошибок
task.spawn(function()
    pcall(function()
        if player.Character then
            safeGodMode(player.Character)
        end
        player.CharacterAdded:Connect(safeGodMode)
        safeAntiBan()
    end)
end)
